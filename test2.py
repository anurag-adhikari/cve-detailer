import pandas as pd
import csv
#initial Data
import csv
with open('data.csv', newline='') as csvfile:
    data = list(csv.reader(csvfile))
#working file creation
f = open("test.csv", "w")
f.close()
#Adding Columns to the newdf
newdf = pd.DataFrame(columns=['ID', 'Modified', 'Published', 'Authentication', 'Complexity', 'Vector', 'Assigner', 'Name', 'Prerequisites', 'Solutions','Summary'])
#print(data.head())
#looping for all the values of cve obtained
for i in range(len(data)):
    print (data[i][0])
    weburl = "https://cve.circl.lu/api/cve/" + data[i][0]
    print(weburl)
    import json, urllib.request, requests
    #parsing all requests
    with urllib.request.urlopen(weburl) as response:
        html = json.loads(response.read())
    print(html['Modified'])
    print(html['Published'])

    try:
        print(html['access']['authentication'])
    except:
        html['access']['authentication'] = '-'
        print(html['access']['authentication'])

    try:
        print(html['access']['complexity'])
    except:
        html['access']['complexity'] = '-'
        print(html['access']['complexity'])

    try:
        print(html['access']['vector'])
    except:
        html['access']['vector'] = '-'
        print(html['access']['vector'])

    try:
        html['capec'][1]['name']
    except:
        html['capec'][1]['name'] = '-'
        print(html['capec'][1]['name'])

    try:
        html['capec'][1]['prerequisites']
    except:
        html['capec'][1]['prerequisites'] = '-'
        print(html['capec'][1]['prerequisites'])


    try:
        html['capec'][1]['solutions']
    except:
        html['capec'][1]['solutions'] = '-'
        print(html['capec'][1]['solutions'])

    try:
        html['capec'][1]['summary']
    except:
        html['capec'][1]['summary'] = '-'
        print(html['capec'][1]['summary'])


    print(html['access']['complexity'])
    print(html['access']['vector'])
    print(html['assigner'])
    fdatas = newdf.append({'ID': data[i][0], 'Modified':html['Modified'], 'Published':html['Published'],\
    'Authentication':html['access']['authentication'], 'Complexity':html['access']['complexity'],\
    'Vector':html['access']['vector'], 'Assigner':html['assigner'], 'Name':html['capec'][1]['name'],\
    'Prerequisites':html['capec'][1]['prerequisites'], 'Solutions':html['capec'][1]['solutions'],'Summary':html['capec'][1]['summary']} , ignore_index=True)
    print(fdatas)